<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, shrink-to-fit=no" />
  <!-- iOS PWA and fullscreen support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Garden Defender" />
  <!-- Android PWA and fullscreen support -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#000000" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#2d4a2b" />
  <!-- Orientation and fullscreen - prefer portrait -->
  <meta name="screen-orientation" content="portrait-primary" />
  <meta name="orientation" content="portrait-primary" />
  <!-- Disable browser features that interfere with games -->
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="msapplication-TileColor" content="#2d4a2b" />
  <meta name="application-name" content="Garden Defender" />
  <!-- Chrome on Android aggressive fullscreen -->
  <meta name="mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="google" content="notranslate" />
  <!-- Additional mobile optimizations -->
  <meta name="HandheldFriendly" content="true" />
  <meta name="MobileOptimized" content="width" />
  <meta name="apple-touch-fullscreen" content="yes" />
  <!-- Prevent iOS elastic scrolling -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <!-- Android Chrome immersive mode hints -->
  <meta name="display-mode" content="fullscreen" />
  <meta name="android-app-immersive" content="true" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/icon.svg" />
  <link rel="icon" type="image/svg+xml" href="/icon.svg" />
  <title>Garden Defender</title>
  <!-- Immediate mobile viewport and fullscreen script -->
  <script>
    // Immediate mobile detection and viewport setup
    (function() {
      const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const isAndroid = /Android/i.test(navigator.userAgent);
      const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      
      if (isMobile) {
        // Immediate viewport height calculation
        function setImmediateViewport() {
          const vh = window.innerHeight * 0.01;
          const vw = window.innerWidth * 0.01;
          
          document.documentElement.style.setProperty('--vh', vh + 'px');
          document.documentElement.style.setProperty('--vw', vw + 'px');
          document.documentElement.style.setProperty('--viewport-height', window.innerHeight + 'px');
          document.documentElement.style.setProperty('--viewport-width', window.innerWidth + 'px');
          
          // Force body height immediately
          document.documentElement.style.height = window.innerHeight + 'px';
          if (document.body) {
            document.body.style.height = window.innerHeight + 'px';
          }
        }
        
        // Immediate address bar hiding
        function hideAddressBarImmediate() {
          setTimeout(() => {
            window.scrollTo(0, 1);
            setTimeout(() => window.scrollTo(0, 0), 50);
            setTimeout(() => window.scrollTo(0, 1), 100);
          }, 10);
        }
        
        // Run immediately
        setImmediateViewport();
        hideAddressBarImmediate();
        
        // Set up listeners for early execution
        window.addEventListener('resize', setImmediateViewport);
        window.addEventListener('orientationchange', () => {
          setTimeout(setImmediateViewport, 100);
          setTimeout(hideAddressBarImmediate, 200);
        });
        
        // Visual viewport API support
        if ('visualViewport' in window) {
          window.visualViewport.addEventListener('resize', () => {
            const viewport = window.visualViewport;
            document.documentElement.style.setProperty('--visual-viewport-height', viewport.height + 'px');
            document.documentElement.style.setProperty('--visual-viewport-width', viewport.width + 'px');
          });
        }
        
        // Android specific immediate optimizations
        if (isAndroid) {
          // Hide chrome UI on Android
          const metaTheme = document.querySelector('meta[name="theme-color"]');
          if (metaTheme) {
            metaTheme.setAttribute('content', '#000000');
          }
          
          // Prevent Android system UI from showing
          document.addEventListener('touchstart', hideAddressBarImmediate, { passive: true });
          document.addEventListener('touchmove', function(e) {
            e.preventDefault();
          }, { passive: false });
        }
        
        // iOS specific immediate optimizations
        if (isIOS) {
          // iOS Safari address bar hiding
          document.addEventListener('touchstart', hideAddressBarImmediate, { passive: true });
          
          // Prevent iOS elastic scrolling
          document.addEventListener('touchmove', function(e) {
            e.preventDefault();
          }, { passive: false });
        }
      }
    })();
  </script>
  <style>
    /* Prevent zoom on iOS */
    body {
      touch-action: manipulation;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    /* Prevent highlighting on touch */
    * {
      -webkit-tap-highlight-color: transparent;
    }
    /* Fullscreen mobile web app styles */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
      background-color: #2d4a2b;
    }
    /* Handle iOS safe areas and notches */
    body {
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      box-sizing: border-box;
    }
    /* Address bar hiding for mobile browsers */
    #game-container {
      height: 100vh;
      height: 100dvh; /* Dynamic viewport height for better mobile support */
    }
  </style>
</head>
<body class="start-screen-active">
  <div id="game-container">
    <h1 id="game-title">ğŸŒ± Garden Defender ğŸ¦</h1>
    
    <!-- Top 3 High Scores Display -->
    <div id="top-scores-display">
      <div id="top-scores-content">
        <div class="top-score-item" id="score-1">
          <span class="rank-icon">ğŸ¥‡</span>
          <span class="score-info">No scores yet</span>
        </div>
        <div class="top-score-item" id="score-2">
          <span class="rank-icon">ğŸ¥ˆ</span>
          <span class="score-info">No scores yet</span>
        </div>
        <div class="top-score-item" id="score-3">
          <span class="rank-icon">ğŸ¥‰</span>
          <span class="score-info">No scores yet</span>
        </div>
      </div>
    </div>
    
    <!-- Main game layout with centered canvas and side panels -->
    <div id="game-layout">
      <!-- Left side panel -->
      <div id="left-panel" class="side-panel">
        <div id="game-stats">
          <div id="score">
            <div class="stat-label">Score</div>
            <div class="stat-value">0</div>
          </div>
          <div id="round">
            <div class="stat-label">Round</div>
            <div class="stat-value">1</div>
          </div>
          <div id="timer">
            <div class="stat-label">Time</div>
            <div class="stat-value">60</div>
          </div>
          <div id="vegetables-left">
            <div class="stat-label">Vegetables</div>
            <div class="stat-value">0</div>
          </div>
          <div id="water-level-container">
            <div id="water-level-label">ğŸ’§ Water</div>
            <div id="water-level-bar">
              <span class="water-indicator">E</span>
              <div id="water-level-fill"></div>
              <span class="water-indicator">F</span>
            </div>
          </div>
        </div>
        <div id="instructions">
          <p class="desktop-only">ğŸ® Arrow keys: move<br>ğŸš¿ SPACE + L/R: spray/tap<br>â¸ï¸ P: pause<br>ğŸšª ESC: quit</p>
          <p class="mobile-only">ğŸ® Optimized for portrait mode<br>ğŸš¿ Use touch controls<br>ğŸš° Near tap + spray = turn on</p>
        </div>
      </div>
      
      <!-- Center game area -->
      <div id="game-center">
        <!-- Dedicated pause notification container -->
        <div id="pause-notification">
          <div id="pause-status"></div>
        </div>
        <div id="start-screen">
          <div id="start-content">
            <h2>Defend Your Garden!</h2>
            <p>ğŸ¿ï¸ Squirrels will steal your vegetables one at a time</p>
            <p>ğŸ¦ Raccoons can carry TWO vegetables at once!</p>
            <p>ğŸ’§ Use your water spray to stop them</p>
            <p>ğŸš° Turn on the water tap if enemies turn it off</p>
            <p class="mobile-only">ğŸ“± Hold device in portrait for best mobile experience</p>
            <div id="start-screen-buttons">
              <button id="start-game-btn">ğŸ® Start New Game</button>
              <button id="load-game-start-btn" disabled>ğŸ“ No Saved Games</button>
            </div>
          </div>
        </div>
        <div id="game-over-screen">
          <div id="game-over-content">
            <h2>ğŸ Game Over! ğŸ</h2>
            <p>You lost all your vegetables!</p>
            <div id="final-score-display">Final Score: 0</div>
            <div id="final-round-display">Reached Round: 1</div>
            <p>ğŸ¿ï¸ğŸ¦ The critters got the better of you this time!</p>
            <p>ğŸ’ª Try again and defend your garden better!</p>
            <button id="start-new-game-btn">ğŸ® Start New Game</button>
          </div>
        </div>
        <div id="game"></div>
      </div>
      
      <!-- Right side panel -->
      <div id="right-panel" class="side-panel">
        <div id="game-controls">
          <div class="control-row-top">
            <button id="music-toggle">ğŸµ Music ON </button>
            <button id="sound-toggle">ğŸ”Š Sounds ON </button>
          </div>
          <div class="control-row-bottom">
            <button id="save-game-btn">ğŸ’¾ Save Game</button>
            <button id="load-game-btn">ğŸ“ Load Game</button>
            <button id="quit-game-btn">ğŸšª Quit Game</button>
          </div>
        </div>
      </div>
      
      <!-- Mobile Touch Controls (part of layout flow) -->
      <div id="mobile-controls" class="side-panel">
        <div id="virtual-joystick">
          <div id="joystick-base">
            <div id="joystick-knob"></div>
          </div>
        </div>
        <div id="action-buttons">
          <button id="spray-btn" class="action-btn">
            <div class="spray-top">ğŸ’§ SPRAY</div>
            <hr class="spray-divider">
            <div class="spray-bottom"><span class="tap-icon">ğŸš°</span> TAP ON</div>
          </button>
          <button id="pause-btn" class="action-btn">â¸ï¸</button>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.js"></script>
</body>
</html>

